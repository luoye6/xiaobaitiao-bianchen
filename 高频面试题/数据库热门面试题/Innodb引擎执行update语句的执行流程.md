# Innodb引擎执行update语句的执行流程?

> 本文作者：[程序员小白条](https://github.com/luoye6)
>
> 本站地址：[https://xbt.xiaobaitiao.top](https://xbt.xiaobaitiao.top)

1.查询解析和优化：当你执行UPDATE语句时，MySQL首先会对查询进行解析，以确定要更新的表和相应的行。然后，它会进行优化，以确定如何执行更新操作。

2.事务的启动：如果你的UPDATE语句没有包含在一个显式的事务中，InnoDB会自动启动一个事务。事务是用来维护数据的一致性和隔离性的机制。

3.锁定行：InnoDB使用行级锁定来确保并发事务不会互相干扰。在执行UPDATE语句时，InnoDB会锁定要更新的行，以防止其他事务同时修改这些行。这可以是排它锁（X锁）或共享锁（S锁），具体取决于事务的隔离级别和行的当前锁定状态。

4.执行更新操作：InnoDB会根据UPDATE语句的条件更新符合条件的行。更新操作将修改数据行中的值。

5.写入redo日志：InnoDB会将更新操作写入事务的redo日志中，以确保数据持久性。这允许数据库在崩溃后恢复到一致的状态。

6.写入binlog日志: 在binlog记录一下逻辑日志，对哪个数据页的哪条数据进行了什么修改。

7.提交事务：如果UPDATE语句没有出现错误，并且没有显式回滚事务，事务将被提交，更新操作将成为持久的。

8.释放锁：在事务提交后，InnoDB会释放之前锁定的行，允许其他事务访问它们。

9.返回结果：UPDATE语句执行完毕后，返回更新的行数或其他相关信息。